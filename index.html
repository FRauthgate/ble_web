<html>
<head>
<title>Coke vending machine nearby!</title>
<script>

async function onButtonClick1() {
  let filters = [];

  filters.push({services: ['b56a46b1-2b62-87aa-a241-3abdaa426dfb']});

  try {
 //   alert('Requesting Bluetooth Device...');
    const device = await navigator.bluetooth.requestDevice({filters: filters});

	try {
		let server = await device.gatt.connect();
		if (server === null) alert("Failed to connect");
alert(server);

//		let service = await server.getPrimaryService('b56a46b1-2b62-87aa-a241-3abdaa426dfb');
//		if (service === null) alert("Failed to find service");

//alert(service);

		characteristic = await server.getCharacteristic('ae955bc6-3fa0-4b88-a7d7-74a7706a0d58');
		if (characteristic === null) alert("Failed to find characteristic");

		alert("Found characteristic");

		value = await characteristic.readValue();
		alert(value);

	} catch(error)  {
		alert("Err!");
		device.gatt.disconnect();
	}

//    alert('> Name:             ' + device.name);
 //   alert('> Id:               ' + device.id);
//    alert('> Connected:        ' + device.gatt.connected);
//    alert('> Connected:        ' + device.gatt.manufacturer);

	} catch(error) {
		alert('Argh! ' + error);
		if (device.gatt.connected) {
			device.gatt.disconnect();
		}
	}
}


async function onButtonClick2() 
{
	navigator.bluetooth.requestDevice(
	{
		filters: [{
			services: ['b56a46b1-2b62-87aa-a241-3abdaa426dfb'],
		}]
	})
	.then(device => device.gatt.connect())
	.then(server => { server.getPrimaryService('b56a46b1-2b62-87aa-a241-3abdaa426dfb'); })
	.then(service => { alert("OK"); service.getCharacteristic('ae955bc6-3fa0-4b88-a7d7-74a7706a0d58'); })
	.then(characteristic => { alert(characteristic.readValue()); });
}


async function onButtonClick3() 
{
	navigator.bluetooth.requestDevice({
		filters: [{
			services: ['b56a46b1-2b62-87aa-a241-3abdaa426dfb']
		}]
	})
	.then(device => {
		alert('Got device:' + device.name);
		alert('id:' + device.id);
		return device.gatt.connect(); 
	})
	.then(server => {
		alert('Getting Service…');
//		return server.getPrimaryService('b56a46b1-2b62-87aa-a241-3abdaa426dfb');
		return server.getPrimaryService('b56a46b1-2b62-87aa-a241-3abdaa426dfb');
	})
	.then(service => {
		alert('Getting Characteristic…');
		return service.getCharacteristic('ae955bc6-3fa0-4b88-a7d7-74a7706a0d58');
	})
	.then(characteristic => {
		alert('Reading amount…');
		return characteristic.readValue();
	})
	.then(value => {
		alert('Amount:' + value);
	})
	.catch(exception => {
		alert(exception);
	});
}
</script>

</head>

<body>

Hello 19:</br> 
<button onClick="onButtonClick1();">Test 1</button></br>
<button onClick="onButtonClick2();">Test 2</button></br>
<button onClick="onButtonClick3();">Test 3</button></br>

</body>
</html>